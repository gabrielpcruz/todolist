<!doctype html>
<html lang="pt-BR">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{% endblock title %}</title>

    <link rel="stylesheet" href="{{ assets('css/libs/bootstrap-5.3.2.min.css') }}?v={{ version() }}">
    <link rel="stylesheet" href="{{ assets('css/style.css') }}?v={{ version() }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"></head>
<body class="overflow-x-hidden">

<nav class="navbar fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Fixed top</a>
    </div>
</nav>

<div class="container-fluid overflow-y-hidden overflow-x-scroll">
    {% block content %}{% endblock content %}
</div>

{% block scripts %}
    <script type="application/javascript" src="{{ assets('js/libs/jquery-3.7.1.min.js') }}?v={{ version() }}"></script>
    <script type="application/javascript" src="{{ assets('js/libs/bootstap-5.3.2.min.js') }}?v={{ version() }}"></script>
    <script type="application/javascript" src="{{ assets('js/libs/draganddropmobile.js') }}?v={{ version() }}"></script>

    <script type="application/javascript" src="{{ assets('js/WebSocketClient.js') }}?v={{ version() }}"></script>
    <script type="application/javascript" src="{{ assets('js/Debounce.js') }}?v={{ version() }}"></script>
    <script type="application/javascript" src="{{ assets('js/Ajax.js') }}?v={{ version() }}"></script>
    <script type="application/javascript" src="{{ assets('js/EventsDispatcher.js') }}?v={{ version() }}"></script>


    <script type="application/javascript" src="{{ assets('js/Card/Card.js') }}?v={{ version() }}"></script>
    <script type="application/javascript" src="{{ assets('js/Board/Board.js') }}?v={{ version() }}"></script>
    <script type="application/javascript" src="{{ assets('js/Card/HandleCardAjax.js') }}?v={{ version() }}"></script>

    <script type="application/javascript" src="{{ assets('js/Kanban/Kanban.js') }}?v={{ version() }}"></script>

    <script>
        jQuery(function () {
            let socket = WebSocketClient.socket();

            socket.onmessage =  function (event) {
                let { data } = event;
                let message = JSON.parse(data);

                if (message.type == "movement") {
                    let card = JSON.parse(message.object);

                    console.log(card)

                    Board.insertCardIntoBoadPosition(
                        $(`#board-` + card.board_id)[0],
                        $(`#` + card.id)[0],
                        card.position
                    );
                }

                if (message.type == "exlude") {
                    let card = JSON.parse(message.object);

                    $(`#` + card.id).remove();
                }

                if (message.type == "insert") {
                    let card = JSON.parse(message.object);

                    let a = Board.makeCardBoard(card, card);

                    Board.insertCardIntoBoadPosition(
                        $(`#board-` + card.board_id)[0],
                        a[0],
                        card.position
                    );
                }

                if (message.type == "edit") {
                    let card = JSON.parse(message.object);

                    $(`#` + card.id).find("[data-state='text']").html(card.description);
                }
            };
        });
    </script>
{% endblock scripts %}
</body>
</html>
